# Learning to Delegate for Large-scale Vehicle Routing

## Metadata
- **Link to PDF**: [[[li2021]_Learning_to_Delegate_for_Large-scale_Vehicle_Routing.pdf]]
- **Tags**:
  - #ML-Supervised
  - #ML-AssistedHeuristics
  - #ML-AssistedLocalSearch
  - #TransformerModels
  - #LargeScaleVRP
  - #CVRP
  - #VRPTW
  - #PDP
  - #DeterministicVRP
  - #LocalSearchHeuristics
  - #RealWorldData
- **Relevant**: true
- **Fit Score**: 10
- **State of the Art (SoA) Concepts**:
  - Transformer-based subproblem selection
  - Iterative local search / delegation to subsolvers
  - LKH-3 and HGS as VRP solvers
  - Applications to CVRP, CVRPTW, VRP with pickup/delivery
  - Speedup vs classical local search heuristics
- **Performance Evaluation**: yes
- **Performance Evaluation Framework**:
  - Custom-synthesized uniform, clustered, and mixed CVRP instances
  - Real-world subset from a Belgium-based CVRP dataset

## Abstract
"Vehicle routing problems (VRPs) form a class of combinatorial problems with wide practical applications. While previous heuristic or learning-based works achieve decent solutions on small problem instances of up to 100 cities, their performance deteriorates in large problems. This article presents a novel learning-augmented local search framework to solve large-scale VRP. The method iteratively improves the solution by identifying appropriate subproblems and delegating their improvement to a black box subsolver. At each step, we leverage spatial locality to consider only a linear number of subproblems, rather than exponential. We frame subproblem selection as regression and train a Transformer on a generated training set of problem instances. Our method accelerates state-of-the-art VRP solvers by 10x to 100x while achieving competitive solution qualities for VRPs with sizes ranging from 500 to 3000. Learned subproblem selection offers a 1.5x to 2x speedup over heuristic or random selection. Our results generalize to a variety of VRP distributions, variants, and solvers."

## Summary
- **Context & Motivation**
  - Addresses the scalability challenge of solving large-scale VRPs, especially for thousands of nodes (e.g., CVRP with up to 3000 locations).
  - Seeks to reduce computational burden while retaining good solution quality, surpassing classical heuristic solvers like LKH-3 in speed.

- **Core Contribution**
  - Proposes a **learning-to-delegate** framework: repeatedly pick and solve small “subproblems” within a large VRP solution.
  - Uses a **Transformer-based regression model** to predict which subproblem (subset of routes) will yield the greatest improvement when given to a high-quality subsolver (e.g., LKH-3 or HGS).
  - Subproblem selection is restricted by **spatial locality**: only subproblems close in centroid or distance are considered, drastically shrinking the combinatorial search space.
  - The iteration updates the overall route solution with the improved subroutes from the subsolver.

- **Methodology**
  - **Local Search + Learning**:
    - Partition the VRP solution into routes. For each route’s centroid, gather a subproblem of k nearest neighboring routes.
    - The Transformer model ranks these candidate subproblems based on predicted potential improvement in cost.
    - The best subproblem is then delegated to a VRP subsolver (LKH-3 or HGS), which optimizes it independently.
    - The global solution is updated with the optimized subroutes if an improvement in objective is realized.
  - **Training Data**:
    - A dataset is generated by enumerating subproblems on synthetic CVRP instances of multiple sizes (500–2000 nodes).
    - Each subproblem is solved by the subsolver; the cost difference is recorded as the label.
    - The model is trained to predict the subproblem’s resulting cost under the subsolver’s new solution.
  - **Network Architecture**:
    - A Transformer encoder processes city features (location, demand).
    - Outputs a scalar prediction for each subproblem’s expected sub-solution cost.
    - Minimizes a Huber loss to stabilize training.

- **Experimental Results & Findings**
  - **Significant Speedup**:
    - Achieves a 10x–15x faster solution time than LKH-3 alone for large CVRP instances (N=2000) at similar or better solution quality.
    - When using HGS as the subsolver, speedups over 100x are reported, due to HGS being optimized for mid-sized CVRPs.
  - **Generalization**:
    - Transfers well to CVRP instances of up to 3000 nodes, as well as real-world demands from a Belgium dataset.
    - A model trained on “clustered” distributions generalized best to new real-world data.
  - **VRP Variants**:
    - Demonstrates similar gains for CVRPTW and VRP with Mixed Pickup and Delivery. 
    - Subproblem delegation combined with learned selection works despite additional constraints.
  - **Comparison to Heuristic Baselines**:
    - Random or coverage-based subproblem selection heuristics are already faster than running the subsolver on the whole instance.
    - However, the learned selector further improves speed, roughly an additional 1.5x–2x, by targeting the most promising subproblems.

- **Strengths & Contributions**
  - Novel combination of local search decomposition and supervised learning-based subproblem identification.
  - Formulation for large-scale problem sizes, surpassing the typical 100-node limit often seen in neural VRP approaches.
  - Empirically validated on multiple distributions, including real data. 
  - Flexible in plugging in any solver that handles the smaller VRP subproblem.

- **Weaknesses & Limitations**
  - Framework requires an upfront generation of training data by enumerating subproblems, which can be computationally heavy.
  - Subproblem approach relies on strong spatial locality assumptions. May lose efficiency for VRPs where geographically close cities do not necessarily form an optimal sub-route (though in practice, it often holds).

- **Impact & Relevance**
  - Highly relevant to deterministic VRP research: focuses on capacity constraints, time windows, pickup/delivery, real-world scaling.
  - Offers a blueprint for combining strong classical solvers (LKH-3, HGS) with ML-based guidance to reduce run-time.
  - Contributes to bridging the gap between purely hand-crafted heuristics and purely neural methods.
  - Advances the frontier of large-scale VRP solutions in a deterministic setting, aligning well with the thesis’s aim to identify ML approaches that scale effectively.